\RequirePackage{etoolbox}
\RequirePackage{booktabs}
\RequirePackage{multirow}

\RequirePackage{tikz}

\RequirePackage{algorithm}
\RequirePackage{algorithmic}

\RequirePackage{geometry}
\geometry{paperwidth=33.86cm,paperheight=19.05cm}

\RequirePackage{graphicx,qibebtcolor}

\RequirePackage{lmodern}
\RequirePackage{xparse}
\RequirePackage{pifont}

\newCJKfontfamily[msyh]\MSYH[Path=assets/fonts/,BoldFont=MSYHBD.TTC]{msyh.ttc}
\newCJKfontfamily[song]\songti[Path=assets/fonts/,BoldFont=SimHei.ttf]{simsun.ttc}
\setCJKmainfont[Path=assets/fonts/,BoldFont=MSYHBD.TTC]{msyh.ttc}
\setCJKsansfont[Path=assets/fonts/,BoldFont=MSYHBD.TTC]{msyh.ttc}

\setbeamerfont{title}{family=\MSYH,size=\fontsize{36}{36}\selectfont,series=\bfseries}
\setbeamerfont{subtitle}{family=\songti,size=\fontsize{25}{25}\selectfont,series=\bfseries}
\setbeamerfont{author}{family=\MSYH,size=\fontsize{28}{28}\selectfont}
\setbeamerfont{date}{family=\MSYH,size=\fontsize{28}{28}\selectfont}
\setbeamerfont{frametitle}{family=\MSYH,size=\fontsize{24}{24}\selectfont,series=\bfseries}
\setbeamerfont{framesubtitle}{family=\songti,size=\fontsize{15}{15}\selectfont}
\setbeamerfont{footline}{size=\fontsize{18}{18}}
\setbeamerfont{block title}{size=\fontsize{20}{20},series=\centering\bfseries}

\renewcommand{\normalsize}{\fontsize{24}{24}\selectfont}
\renewcommand{\small}{\fontsize{20}{20}\selectfont}
\renewcommand{\footnotesize}{\fontsize{16}{16}\selectfont}

\RequirePackage{fontspec}
\setsansfont{Times New Roman}

\usefonttheme[onlymath]{serif}

% 封面
\setbeamertemplate{title page}{
    \thispagestyle{empty}
    \begin{tikzpicture}[remember picture,overlay]
    \fill[maincolor]
    (current page.north west) rectangle (current page.south east);

    \node[anchor=east]
    at ([yshift=-30pt, xshift=-10pt]current page.east) (side_logo){
        \parbox[t]{\paperwidth}{
            \raggedleft
            \includegraphics[width=0.5\textwidth]{assets/logo_RGB.png}
        }
    };

    \fill[maincolor, fill opacity=0.75]
    (current page.north west) rectangle (current page.south east);

    \node[anchor=north west]
    at ([yshift=-10pt, xshift=15pt]current page.north west) (logo){
        \includegraphics[width=0.5\paperwidth]{assets/title_logo.png}
    };

    \node[anchor=west]
    at ([yshift=10pt,xshift=10pt]current page.west) (title){
        \parbox[t]{0.55\textwidth}{
            \usebeamerfont{title}
            \textcolor{white}{\inserttitle}
        }
    };

    \node[anchor=west]
    at ([yshift=-80pt,xshift=20pt]current page.west) (subtitle){
        \parbox[t]{0.55\paperwidth}{
            \usebeamerfont{subtitle}
            \textcolor{qibebtgray}{\insertsubtitle}
        }
    };
    
    \node[anchor=center]
    at ([yshift=110pt, xshift=-80pt]current page.south) (author){
        \usebeamerfont{author}
        \textcolor{white}{汇报人：\insertauthor}
    };
    
    \node[anchor=center]
    at ([yshift=50pt, xshift=-80pt]current page.south) (date){
        \usebeamerfont{date}
        \textcolor{white}{\insertdate}
    };
    \end{tikzpicture}
}

% 目录页
\AtBeginSection[]{
    \begingroup
    \begin{frame}{Table of Contents}
        \thispagestyle{empty}
        \setbeamercolor{normal text}{fg=white,bg=maincolor}
		\setbeamercolor{structure}{fg=white}
        \begin{tikzpicture}[remember picture,overlay]
            \fill[maincolor]
            (current page.north west) rectangle (current page.south east);

            \node[anchor=east]
            at ([yshift=-30pt, xshift=-10pt]current page.east) (side_logo){
                \parbox[t]{\paperwidth}{
                    \raggedleft
                    \includegraphics[width=0.5\textwidth]{assets/logo_RGB.png}
                }
            };
        
            \fill[maincolor, fill opacity=0.75]
            (current page.north west) rectangle (current page.south east);

            \node[anchor=north]
            at ([yshift=-30pt]current page.north) (title){
                \usebeamerfont{title}
                \textcolor{white}{目录}
            };
            
            \draw [line width =2pt,color=white] 
            ([yshift=-78pt,xshift=-100]current page.north)
            --
            ([yshift=-78pt,xshift=100]current page.north);

            \node[anchor=north]
            at ([yshift=-80pt]current page.north) (title){
                \usebeamerfont{subtitle}
                \textcolor{white}{CONTENTS}
            };
        \end{tikzpicture}
        \tableofcontents[currentsection]
    \end{frame}
    \endgroup
}
\setbeamertemplate{section in toc}{$\blacktriangleright$~\inserttocsection}

% 页眉
\setbeamertemplate{headline}{
    \begin{tikzpicture}[remember picture,overlay]            
        \draw [color=maincolor] 
        ([yshift=-60pt,xshift=-345]current page.north)
        --
        ([yshift=-60pt,xshift=425]current page.north);
    
        \node[anchor=north east]
        at ([yshift=-20pt,xshift=-50]current page.north east) (group_logo){
            \includegraphics[width=0.095\textwidth]{assets/sc_logo.png}
        };
    \end{tikzpicture}
    \hspace{0.04\textwidth}
    \includegraphics[width=0.09\paperwidth]{assets/logo_RGB_negative.png}
}
\setbeamertemplate{frametitle}{
    \vspace{-6ex}
    \begin{beamercolorbox}[leftskip=4cm]{frametitle}
        \usebeamerfont{frametitle}\textcolor{black}{\insertframetitle}\\
    \end{beamercolorbox}
    
    % 设置副标题的绝对位置
    \begin{tikzpicture}[remember picture,overlay]
        \node[anchor=north west] 
        at ([yshift=-5.1ex,xshift=4.5cm]current page.north west) {
            \usebeamerfont{framesubtitle}\textcolor{darkgray}{\insertframesubtitle}
        };
    \end{tikzpicture}
}
\makeatletter
    \pretocmd\beamer@checkframetitle{\framesubtitle{\thesection \, \secname}}
\makeatother

% 页脚
\setbeamercolor{footline}{fg=darkgray, bg=}
\setbeamertemplate{footline}{
  \begin{beamercolorbox}[wd=\textwidth,ht=5mm,dp=3mm,rightskip=1cm,leftskip=1cm]{footline}
  \insertframenumber/\inserttotalframenumber
  \end{beamercolorbox}
}

% 结束页
\newcommand{\backmatter}[1][]{
\begingroup
    \begin{frame}
    \thispagestyle{empty}
    \begin{tikzpicture}[remember picture,overlay]
        \fill[maincolor]
        (current page.north west) rectangle (current page.south east);
    
        \node[anchor=east]
        at ([yshift=-30pt, xshift=-10pt]current page.east) (side_logo){
            \parbox[t]{\paperwidth}{
                \raggedleft
                \includegraphics[width=0.5\textwidth]{assets/logo_RGB.png}
            }
        };
    
        \fill[maincolor, fill opacity=0.75]
        (current page.north west) rectangle (current page.south east);
    
        \node[anchor=north west]
        at ([yshift=-10pt, xshift=15pt]current page.north west) (logo){
            \includegraphics[width=0.5\paperwidth]{assets/title_logo.png}
        };
    \end{tikzpicture}
    \centering
    \usebeamerfont{title}\textcolor{white}{\inserttitle}\\
    \usebeamerfont{frametitle}\textcolor{white}{\\Thank you for listening! \\ Any questions?}
    \end{frame}
\endgroup
}

\setbeamertemplate{itemize item}{\textbullet}
\setbeamertemplate{itemize subitem}{\ensuremath{\circ}}
% \setbeamertemplate{itemize subsubitem}{\ensuremath{\circ}}

% \setbeamerfont{itemize/enumerate body}{size=\normalsize}
% \setbeamerfont{itemize/enumerate subbody}{size=\small}
% \setbeamerfont{itemize/enumerate subsubbody}{size=\footnotesize}

% 居中列表
\NewDocumentEnvironment{citemize}{ m }
{
    % 使用传入的参数来定义 minipage 的宽度，并居中
    \begin{center}
    \begin{minipage}{#1\textwidth}
    \begin{itemize}
}
{
    \end{itemize}
    \end{minipage}
    \end{center}
}

\NewDocumentEnvironment{cenumerate}{ m }
{
    % 使用传入的参数来定义 minipage 的宽度，并居中
    \begin{center}
    \begin{minipage}{#1\textwidth}
    \begin{enumerate}
}
{
    \end{enumerate}
    \end{minipage}
    \end{center}
}

% 自定义列表项
\newcommand{\litem}[1][\relax]{%
    \vspace{20pt}
    \ifthenelse{\equal{#1}{\relax}}{\item}{%
    \ifthenelse{\equal{#1}{Y}}{\item \textcolor{green}{\ding{52}}}{\item \textcolor{red}{\ding{56}}}}%
}

\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{frametitle continuation}{}